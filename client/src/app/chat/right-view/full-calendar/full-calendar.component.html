<div class="container_calendar">
  <div class="container_header">
    <div class="container_header_date">
      <button mat-icon-button class="btn_change" (click)="prevMonth()">
        <mat-icon>chevron_left</mat-icon>
      </button>
      <span class="header_date">{{chatSelector.months[chatSelector.selectedMonth]}} {{chatSelector.selectedYear}}</span>
      <button mat-icon-button class="btn_change " (click)="nextMonth()">
        <mat-icon>chevron_right</mat-icon>
      </button>
    </div>
  </div>
  <table id="table_calendar">
    <thead>
      <tr>
        <th *ngFor="let day of chatSelector.weekDays">{{day}}</th>
      </tr>
    </thead>
    <tbody>
      <tr>
        <td class="day_calendar" *ngFor="let day of chatSelector.weekDays; let i=index"
          [ngStyle]="checkFistDayOfMonth(i)">
          <div class="calendar_container" (click)="goToDate(0, i, $event)" (dblclick)="createEvent($event)">
            <div class="date_month">{{getThisDate(0, i)}}</div>
            <div class="calendar_day_list">
              <div class="calendar_day_events" *ngFor="let cal_events of chatSelector.EventsPerMonth[getThisDate(0,i)]"
                [ngStyle]="{'background-color' : cal_events.color}" [title]="cal_events.title"
                (dblclick)="seeEvent(cal_events)">
                <span class="calendar_day_type">{{checkIfIsPersonalOrShared(cal_events)}}</span>
                <p class="text-truncate calendar_day_title">{{cal_events.title}}</p><span
                  class="calendar_day_time">{{chatSelector.getHoursAndMinutes(cal_events.date)}}</span>
              </div>
            </div>
            <div class="calendar_day_more_events" *ngIf="checkIfThereAreManyEvents(0, i)">
              ...
            </div>
          </div>
        </td>
      </tr>
      <tr>
        <td class="day_calendar" *ngFor="let day of chatSelector.weekDays; let i = index">
          <div class="calendar_container" (click)="goToDate(1, i, $event)" (dblclick)="createEvent($event)">
            <div class="date_month">{{getThisDate(1, i)}}</div>
            <div class="calendar_day_list">
              <div class="calendar_day_events" *ngFor="let cal_events of chatSelector.EventsPerMonth[getThisDate(1,i)]"
                [ngStyle]="{'background-color' : cal_events.color}" [title]="cal_events.title"
                (dblclick)="seeEvent(cal_events)">
                <span class="calendar_day_type">{{checkIfIsPersonalOrShared(cal_events)}}</span>
                <p class="text-truncate calendar_day_title">{{cal_events.title}}</p><span
                  class="calendar_day_time">{{chatSelector.getHoursAndMinutes(cal_events.date)}}</span>
              </div>
            </div>
            <div class="calendar_day_more_events" *ngIf="checkIfThereAreManyEvents(1, i)">
              ...
            </div>
          </div>
        </td>
      </tr>
      <tr>
        <td class="day_calendar" *ngFor="let day of chatSelector.weekDays; let i = index">
          <div class="calendar_container" (click)="goToDate(2, i, $event)" (dblclick)="createEvent($event)">
            <div class="date_month">{{getThisDate(2, i)}}</div>
            <div class="calendar_day_list">
              <div class="calendar_day_events" *ngFor="let cal_events of chatSelector.EventsPerMonth[getThisDate(2,i)]"
                [ngStyle]="{'background-color' : cal_events.color}" [title]="cal_events.title"
                (dblclick)="seeEvent(cal_events)">
                <span class="calendar_day_type">{{checkIfIsPersonalOrShared(cal_events)}}</span>
                <p class="text-truncate calendar_day_title">{{cal_events.title}}</p><span
                  class="calendar_day_time">{{chatSelector.getHoursAndMinutes(cal_events.date)}}</span>
              </div>
            </div>
            <div class="calendar_day_more_events" *ngIf="checkIfThereAreManyEvents(2, i)">
              ...
            </div>
          </div>
        </td>
      </tr>
      <tr>
        <td class="day_calendar" *ngFor="let day of chatSelector.weekDays; let i = index">
          <div class="calendar_container" (click)="goToDate(3, i, $event)" (dblclick)="createEvent($event)">
            <div class="date_month">{{getThisDate(3, i)}}</div>
            <div class="calendar_day_list">
              <div class="calendar_day_events" *ngFor="let cal_events of chatSelector.EventsPerMonth[getThisDate(3,i)]"
                [ngStyle]="{'background-color' : cal_events.color}" [title]="cal_events.title"
                (dblclick)="seeEvent(cal_events)">
                <span class="calendar_day_type">{{checkIfIsPersonalOrShared(cal_events)}}</span>
                <p class="text-truncate calendar_day_title">{{cal_events.title}}</p><span
                  class="calendar_day_time">{{chatSelector.getHoursAndMinutes(cal_events.date)}}</span>
              </div>
            </div>
            <div class="calendar_day_more_events" *ngIf="checkIfThereAreManyEvents(3, i)">
              ...
            </div>
          </div>
        </td>
      </tr>
      <tr>
        <td class="day_calendar" *ngFor="let day of chatSelector.weekDays; let i = index"
          [ngStyle]="checkLastDayOfMonth(i)">
          <div class="calendar_container" (click)="goToDate(4, i, $event)" (dblclick)="createEvent($event)">
            <div class="date_month">{{getThisDate(4, i)}}</div>
            <div class="calendar_day_list">
              <div class="calendar_day_events" *ngFor="let cal_events of chatSelector.EventsPerMonth[getThisDate(4,i)] "
                [ngStyle]="{'background-color' : cal_events.color}" [title]="cal_events.title"
                (dblclick)="seeEvent(cal_events)">
                <span class="calendar_day_type">{{checkIfIsPersonalOrShared(cal_events)}}</span>
                <p class="text-truncate calendar_day_title">{{cal_events.title}}</p><span
                  class="calendar_day_time">{{chatSelector.getHoursAndMinutes(cal_events.date)}}</span>
              </div>
            </div>
            <div class="calendar_day_more_events" *ngIf="checkIfThereAreManyEvents(4, i)">
              ...
            </div>
          </div>
        </td>
      </tr>
      <tr>
        <td class="day_calendar" *ngFor="let day of chatSelector.weekDays; let i = index"
          [ngStyle]="checkLastDayOfMonth(i,5)">
          <div class="calendar_container" (click)="goToDate(5, i, $event)" (dblclick)="createEvent($event)">
            <div class="date_month">{{getThisDate(5, i)}}</div>
            <div class="calendar_day_list">
              <div class="calendar_day_events" *ngFor="let cal_events of chatSelector.EventsPerMonth[getThisDate(5,i)]"
                [ngStyle]="{'background-color' : cal_events.color}" [title]="cal_events.title"
                (dblclick)="seeEvent(cal_events)">
                <span class="calendar_day_type">{{checkIfIsPersonalOrShared(cal_events)}}</span>
                <p class="text-truncate calendar_day_title">{{cal_events.title}}</p><span
                  class="calendar_day_time">{{chatSelector.getHoursAndMinutes(cal_events.date)}}</span>
              </div>
            </div>
            <div class="calendar_day_more_events" *ngIf="checkIfThereAreManyEvents(5, i)">
              ...
            </div>
          </div>
        </td>
      </tr>
    </tbody>
  </table>
</div>

<div class="cal_modal" *ngIf="chatSelector.triggerCalendarModal" (click)="close($event)">
  <div class="cal_modal_container">
    <div class="cal_modal_header">
      <h3 class="cal_modal_title">{{chatSelector.selectedCalendarEvent?.title}}</h3>
      <span class="cal_modal_close" (click)="closeModal()">&times;</span>
    </div>
    <div class="cal_modal_body">
      <div class="cal_modal_body_container">
        <div class="cal_modal_datetime">
          <div class="cal_modal_date">
            <i class="bi bi-clock"></i>
            <input matInput [matDatepicker]="datepicker"  [value]="chatSelector.selectedCalendarEvent?.date" readonly [min]="today"/>
            <mat-datepicker-toggle matIconSuffix [for]="datepicker" [ngStyle]="{'visibility' : isOnModifyingMode ? 'visible': 'hidden'}"></mat-datepicker-toggle>
            <mat-datepicker #datepicker></mat-datepicker>
          </div>
          <input type="time" class="cal_modal_time" [value]="chatSelector.selectedCalendarEvent?.date | date: 'HH:mm'" [readonly]="!isOnModifyingMode">

        </div>


        <div class="cal_modal_description">
          <div class="cal_modal_desc_header">
            <i class="bi bi-card-text"></i>
            <label for="cal_modal_desc">Description</label>
          </div>
          <textarea class="form-control" placeholder="Description" id="cal_modal_desc"
            [readOnly]="!isOnModifyingMode">{{chatSelector.selectedCalendarEvent?.description}}</textarea>
        </div>
        <div class="cal_modal_notify">
          <div *ngIf="chatSelector.selectedCalendarEvent?.notify">
            <i class="bi bi-bell"></i>
            <span class="cal_modal_notify_value">{{chatSelector.selectedCalendarEvent?.notifyTime}}</span>
          </div>
          <div *ngIf="!chatSelector.selectedCalendarEvent?.notify">
            <i class="bi bi-bell-slash-fill"></i>
            <span>Notifica non impostata</span>
          </div>
        </div>
      </div>
    </div>
    <div class="cal_modal_footer">
      <button class="cal_modal_modify btn btn-secondary" *ngIf="isOnModifyingMode" (click)="exitModifyingMode($event)">Annulla</button>
      <button class="cal_modal_modify btn "
        [ngClass]="{'btn-primary' : !isOnModifyingMode, 'btn-success': isOnModifyingMode}"
        *ngIf="checkIfThaEventCanBeModified()" (click)="modifyEvent($event)">Modifica</button>
    </div>
  </div>
